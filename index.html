<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Better D3 with the Reusable API</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/solarized.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h1>Better D3 with the Reusable API</h1>
					<img width="252" height="236" data-src="img/d3js.png" alt="D3 Logo">
                    <aside class="notes">
                        <ul>
                            <li>Lots of Content</li>
                            <li>Fast, questions at the end</li>
                            <li>Introductory and focused on learning</li>
                        </ul>
                    </aside>
				</section>

				<section>
					<h2>D3</h2>
					<ul>
						<li>Data-Driven Documents</li>
						<li>JavaScript Library to manipulate data based documents</li>
						<li>Uses open web standards (SVG, HTML and CSS)</li>
						<li>Some data parsing</li>
						<li>Allows interaction with your graphs</li>
					</ul>
                    <aside class="notes">
                        <ul>
                            <li>Huge API</li>
                        </ul>
                    </aside>
				</section>

				<section>
					<section>
						<h1>What can you do with D3?</h1>
					</section>

					<section>
						<h2>Bar Charts</h2>
						<img data-src="img/barchart_Fotor.jpg" alt="Bar Chart">
					</section>

					<section>
						<h2>Pie Charts</h2>
						<img data-src="img/Pie Chart_Fotor.jpg" alt="Pie Chart">
					</section>

					<section>
						<h2>Bubble Charts</h2>
						<a target="_blank" href="http://bl.ocks.org/mbostock/4063530"><img data-src="img/bubble.png" alt="Bubble Chart" style="width: 60%;"></a>
					</section>

					<section>
						<h2>Choropleth</h2>
						<a target="_blank" href="http://bl.ocks.org/mbostock/4060606"><img src="img/choropleth.png" alt="" style="width: 80%;"></a>
					</section>

					<section>
						<h2>Azimuthal Projections</h2>
						<a target="_blank" href="http://mbostock.github.io/d3/talk/20111018/azimuthal.html"><img src="img/azimuthal_Fotor.jpg" alt="" style="width: 80%;"></a>
					</section>

					<section>
						<h2>Dashboards</h2>
						<a target="_blank" href="http://coenraets.org/apps/olympic-d3/#dashboard/3"><img src="img/dashboard.png"  style="width: 60%;"></a>
					</section>

					<section>
						<h2>Algorithm Visualization</h2>
						<a target="_blank" href="http://bl.ocks.org/mbostock/1044242"><img src="img/edge-bundling.png" alt="Hierarchical Edge Bundling" style="width: 60%;"></a>
					</section>

					<section>
						<h2>Interactive Infographics</h2>
						<a target="_blank" href="http://www.nytimes.com/interactive/2012/02/13/us/politics/2013-budget-proposal-graphic.html?_r=0"><img src="img/budget.png" alt="Obama Budget Proposal" style="width: 80%;"></a>
					</section>

					<section>
						<h2>Artistic visualizations</h2>
						<a target="_blank" href="http://alanahryding.me/blog/?p=618"><img data-src="img/d3_javascript_death2.png" alt="Pie Chart"></a>
					</section>

					<section>
						<h2>Funny Interactions</h2>
						<a target="_blank" href="http://www.koalastothemax.com/">Koalas to the Max</a>
					</section>
				</section>

				<section>
					<h2>What is D3 doing?</h2>
					<ul>
						<li class="fragment">Loads data</li>
						<li class="fragment">Binds data to elements</li>
						<li class="fragment">Transforms those elements</li>
						<li class="fragment">Transitions between states on demand</li>
					</ul>
				</section>

				<section>
					<h2>D3 Advantages</h2>
					<ul>
						<li>Based on attaching data to the DOM</li>
						<li>Styling of elements with CSS</li>
                        <li>Transitions and Animations baked in</li>
                        <li>Total control over our graphs</li>
                    </ul>
                    <aside class="notes">
                        <ul>
                            <li>Same tools as FE development</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h2>Pain points</h2>
                    <ul>
                        <li>Update, Enter and Exit Pattern</li>
                        <li>Chaining</li>
                        <li>Data Manipulation</li>
                        <li>Margins and dimensions</li>
                        <li>Scales and Axes</li>
                        <li>Tooltips</li>
                    </ul>
                    <aside class="notes">
                        <ul>
                            <li>All data viz needs work on the data side</li>
                            <li>Underscore functions helps sometimes</li>
    						<li>The community and Bostock has develop patterns</li>
                        </ul>
                    </aside>
				</section>

				<section>
					<h2>Workflow</h2>
					<ul>
						<li class="fragment">Idea or Requirement</li>
						<li class="fragment">Search for an example</li>
						<li class="fragment">Adapt the code</li>
                        <li class="fragment">Add features</li>
						<li class="fragment">Polish Look and Feel</li>
					</ul>
				</section>

				<section>
					<h2>Standard D3 Examples</h2>
					<ul>
						<li>
							By chart type: <a target="_blank" href="http://christopheviau.com/d3list/gallery.html">Christophe's Viau Gallery</a>
						</li>
						<li>
							By D3 components: <a target="_blank" href="http://bl.ocksplorer.org/">Mike Bostock's Block Explorer</a>
						</li>
					</ul>
				</section>

				<section>
					<h2>Code Example</h2>
					<p><a target="_blank" href="http://bl.ocks.org/mbostock/3885304">Bar Chart Example</a> by Mike Bostock</p>
                    <aside class="notes">
                        <ul>
                            <li>Simplest example</li>
                            <li>Still, almost spagetti code</li>
                        </ul>
                    </aside>
				</section>

				<section>
					<h2>Creating Container</h2>
					<pre><code data-trim contenteditable>
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
    	"translate(" + margin.left + "," + margin.top + ")");
					</code></pre>
                    <aside class="notes">
                        <ul>
                            <li>Margins and sizes</li>
                            <li>A bit messy, but only once per graph and with this pattern</li>
                        </ul>
                    </aside>
				</section>

				<section>
					<h2>Creating Scales and Axes</h2>
					<pre><code data-trim contenteditable>
var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(10, "%");
					</code></pre>
				</section>

				<section>
					<h2>Loads Data</h2>
					<pre><code data-trim contenteditable>
d3.tsv("data.tsv", type, function(error, data) {
    // Chart Code
};

function type(d) {
  d.frequency = +d.frequency;
  return d;
}
					</code></pre>
				</section>

				<section>
					<h2>Draws Axes</h2>
					<pre><code data-trim contenteditable>
x.domain(data.map(function(d) { return d.letter; }));
y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Frequency");
					</code></pre>
				</section>

				<section>
					<h2>Draws Chart Bars</h2>
					<pre><code data-trim contenteditable>
svg.selectAll(".bar")
    .data(data)
  .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d) { return x(d.letter); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.frequency); })
    .attr("height", function(d) { return height - y(d.frequency); });
					</code></pre>
				</section>

				<section>
					<h2>Result</h2>
					<img src="img/mbBarChart_Fotor.jpg" height="493" width="945" alt="">
				</section>

				<section>
					<h2>Standard D3: Drawbacks</h2>
					<ul>
						<li class="fragment">Monolithic functions</li>
						<li class="fragment">Chained method calls</li>
						<li class="fragment">Hard to change stuff</li>
						<li class="fragment">Impossible to reuse</li>
					</ul>
				</section>


				<section>
					<h2>Reusable API</h2>
					<ul>
						<li class="fragment">Configurable</li>
                        <li class="fragment">Repeatable</li>
                        <li class="fragment">Composable</li>
                        <li class="fragment">Decoupled</li>
                        <li class="fragment">Consistent</li>
					</ul>
                    <aside class="notes">
                        <ul>
                            <li>Configurable: We can change look and feel and behaviour without changing the code</li>
                            <li>Repeatable: Different charts with the same code</li>
                            <li>Composable: It can contain inner charts</li>
                            <li>Decoupled: We differientate the core of the graph from the configuration</li>
                            <li>Consistent: Following the same strategy we can reuse even pieces between charts</li>
                        </ul>
                    </aside>
				</section>

                <section>
                    <h2>Chart Test</h2>
                    <pre><code data-trim contenteditable>
it('should render a chart with minimal requirements', function(){
    expect(containerFixture.select('.bar-chart')).toBeDefined(1);
});
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Code</h2>
                    <pre><code data-trim contenteditable>
demo.graphs.barChart = function module(){

    var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = 960,
        height = 500;

    var svg;

    function exports(_selection){
        _selection.each(function(_data){
            var chartW = width - margin.left - margin.right,
                chartH = height - margin.top - margin.bottom;

            if (!svg) {
                svg = d3.select(this)
                    .append('svg')
                    .classed('bar-chart', true);
            }

        });
    };

    return exports;
}
                    </code></pre>
                </section>

                <section>
					<h2>Chart Test</h2>
					<pre><code data-trim contenteditable>
it('should render container, axis and chart groups', function(){
    expect(containerFixture.select('g.container-group')[0][0]).not.toBeNull();
    expect(containerFixture.select('g.chart-group')[0][0]).not.toBeNull();
    expect(containerFixture.select('g.x-axis-group')[0][0]).not.toBeNull();
    expect(containerFixture.select('g.y-axis-group')[0][0]).not.toBeNull();
});
					</code></pre>
				</section>

				<section>
					<h2>Chart Code</h2>
					<pre><code data-trim contenteditable>
function buildContainerGroups(){
    var container = svg.append("g").classed("container-group", true);

    container.append("g").classed("chart-group", true);
    container.append("g").classed("x-axis-group axis", true);
    container.append("g").classed("y-axis-group axis", true);
    container.append("g").classed("pane-group", true);
    container.append("g").classed("metadata-group", true);
}
					</code></pre>
				</section>

                <section>
                    <h2>Chart Test</h2>
                    <pre><code data-trim contenteditable>
it('should render an X and Y axis', function(){
    expect(containerFixture.select('.x.axis')[0][0]).not.toBeNull();
    expect(containerFixture.select('.y.axis')[0][0]).not.toBeNull();
});
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Code</h2>
                    <pre><code data-trim contenteditable>
function buildScales(){
    xScale = d3.scale.ordinal()
        .domain(data.map(function(d) { return d.letter; }))
        .rangeRoundBands([0, chartW], .1);

    yScale = d3.scale.linear()
        .domain([0, d3.max(data, function(d) { return d.frequency; })])
        .range([chartH, 0]);
}
function buildAxis(){
    xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom");

    yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left")
        .ticks(10, "%");
}
function drawAxis(){
    svg.select('.x-axis-group')
        .append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + chartH + ")")
        .call(xAxis);

    svg.select(".y-axis-group")
        .append("g")
        .attr("class", "y axis")
        .call(yAxis)
      .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Frequency");
}
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Test</h2>
                    <pre><code data-trim contenteditable>
it('should render a bar for each data entry', function(){
    var numBars = dataset.length;

    expect(containerFixture.selectAll('.bar')[0].length).toEqual(numBars);
});
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Code</h2>
                    <pre><code data-trim contenteditable>
function drawBars(){
    // Setup the enter, exit and update of the actual bars in the chart.
    // Select the bars, and bind the data to the .bar elements.
    var bars = svg.select('.chart-group').selectAll(".bar")
        .data(data);

    // If there aren't any bars create them
    bars.enter().append('rect')
        .attr("class", "bar")
        .attr("x", function(d) { return xScale(d.letter); })
        .attr("width", xScale.rangeBand())
        .attr("y", function(d) { return yScale(d.frequency); })
        .attr("height", function(d) { return chartH - yScale(d.frequency); });
}
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Test</h2>
                    <pre><code data-trim contenteditable>
it('should provide margin getter and setter', function(){
    var defaultMargin = barChart.margin(),
        testMargin = {top: 4, right: 4, bottom: 4, left: 4},
        newMargin;

    barChart.margin(testMargin);
    newMargin = barChart.margin();

    expect(defaultMargin).not.toBe(testMargin);
    expect(newMargin).toBe(testMargin);
});
                    </code></pre>
                </section>

                <section>
                    <h2>Chart Code</h2>
                    <pre><code data-trim contenteditable>
exports.margin = function(_x) {
    if (!arguments.length) return margin;
    margin = _x;
    return this;
};
                    </code></pre>
                </section>

				<section>
					<h2>Learning D3</h2>
					<ul>
						<li><a href="">Books</a></li>
						<li><a href="">Tutorials</a></li>
						<li><a href="">Reference</a></li>
					</ul>
				</section>

				<section>
					<section>
						<h2>Books</h2>
					</section>

					<section>
						<img src="img/gettingStarted.jpg" style="width: 50%;">
						<aside class="notes">
							<ul>
								<li>Super Fast introduction (<60 pg.)</li>
								<li>Enter Selections, Scales, Axes</li>
								<li>Interactions and Transitions</li>
								<li>Layouts</li>
							</ul>
						</aside>
					</section>

					<section>
						<img src="img/interactivedatacover.jpg" style="width: 50%;">
						<aside class="notes">
							<ul>
								<li>Intro Book</li>
								<li>Starting from 0 and no experience on FE</li>
								<li>GeoJSON and Maps</li>
							</ul>
						</aside>
					</section>

					<section>
						<img src="img/developingad3edge.jpg" style="width: 50%;">
						<aside class="notes">
							<ul>
								<li>It provides a way of creating reusable charts in a way we could all use</li>
								<li>Charts are simple and test friendly</li>
								<li>You can create larger ones by composition</li>
								<li>Introduces a data loader module</li>
								<li>Proposes some tests with Jasmine</li>
								<li>All in a small size</li>
							</ul>
						</aside>
					</section>

					<section>
						<img src="img/MasteringD3.jpg" style="width: 50%;">
						<aside class="notes">
							<ul>
								<li>Same Reusable charts</li>
								<li>Ambitious book, almost a reference</li>
								<li>Integrations: Backbone, Socket.IO, Mapbox.</li>
								<li>Great number of different charts: Choropleth, Area, Advanced Maps</li>
								<li>Side technologies: Jekyll, NPM, Grunt, Vows</li>
								<li>Less Importance to Tests, great book</li>
							</ul>
						</aside>
					</section>

					<section>
						<img src="img/information-dashboard-design.jpg" style="width: 50%;">
						<aside class="notes">
							<ul>
								<li>Data science and Usability Book</li>
								<li>Author has a clear idea</li>
								<li>Word 97 layout</li>
							</ul>
						</aside>
					</section>
				</section>

				<section>
					<h2>Tutorials</h2>
					<ul>
						<li><a target="_blank" href="https://www.dashingd3js.com/table-of-contents">Dashing D3.js</a></li>
						<li><a target="_blank" href="http://wowsuchlist.com/lists/80-resources-for-learning-d3-js">Tutorials</a></li>
						<li><a target="_blank" href="http://alignedleft.com/tutorials/d3/">Scott Murray Tutorials</a></li>
					</ul>
				</section>

				<section>
					<h2>Reference</h2>
					<ul>
						<li>
							<a target="_blank" href="https://github.com/mbostock/d3/wiki">D3 Wiki</a>
						</li>
						<li>
							<a target="_blank" href="https://github.com/mbostock/d3/wiki/API-Reference">API Reference</a>
						</li>
						<li>
							<a target="_blank" href="http://stackoverflow.com/questions/tagged/d3.js">D3 on StackOverflow</a>
						</li>
						<li>
							<a target="_blank" href="http://www.datameer.com/blog/howto/getting-started-with-d3-js.html">Getting started guide</a>
						</li>
					</ul>
				</section>

                <section>
                    <h2>Thanks For listening!</h2>
                    <ul>
                        <li>
                            <a target="_blank" href="https://twitter.com/golodhros">@golodhros</a>
                        </li>
                        <li>
                            <a target="_blank" href="http://www.marcosiglesias.com/posts">Blog</a>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Extras: Tricks</h2>
                    <ul>
                        <li>
                            <a target="_blank" href="http://bl.ocks.org/mbostock/3808218">General Update Pattern</a>
                            <a target="_blank" href="http://bl.ocks.org/mbostock/3019563">Margin Convention</a>
                            <a target="_blank" href="http://bl.ocks.org/zanarmstrong/ca0adb7e426c12c06a95">Time Formats</a>
                        </li>
                    </ul>
                </section>


                <section>
                    <h2>Data Loader Test</h2>
                    <pre><code data-trim contenteditable>
describe('Initialization', function(){
    it('defines a dataManager object', function(){
        expect(demo.graphs.dataManager).toBeDefined();
    });

    it('can be called like a constructor', function(){
        expect(typeof demo.graphs.dataManager).toBe('function');
        expect(demo.graphs.dataManager()).toBeDefined();
    });
});
                    </code></pre>
                </section>

                <section>
                    <h2>Data Loader Test II</h2>
                    <pre><code data-trim contenteditable>
describe('Interface', function(){

    beforeEach(function(){
        dataManager = demo.graphs.dataManager();
        spyOn(dataManager, 'on').and.callThrough();
    });

    it('triggers dataReady when data loaded', function(done){
        var dataReadyHandler = function(result){
            done();
        };

        dataManager.on('dataReady', dataReadyHandler);
        dataManager.loadJsonData(fixturePath + 'dummyData.json', function(d){
            d = d;
        });

        expect(dataManager.on).toHaveBeenCalled();
        expect(dataManager.on).toHaveBeenCalledWith('dataReady', dataReadyHandler);
    });

});
                    </code></pre>
                </section>

                <section>
                    <h2>Data Loader Test III</h2>
                    <pre><code data-trim contenteditable>
describe('Interface', function(){

    it('triggers dataError when data point fails', function(done){
        var dataErrorHandler = function(result){
            done();
        };

        dataManager.on('dataError', dataErrorHandler);
        dataManager.loadJsonData(fixturePath + 'fake.json', function(d){
            d = d;
        });

        expect(dataManager.on).toHaveBeenCalled();
        expect(dataManager.on).toHaveBeenCalledWith('dataError', dataErrorHandler);
    });

    it('returns loaded data', function(done){
        var newData;

        dataManager.on('dataReady', function(result){
            newData = result;
            expect(newData).toHaveLength(12);
            done();
        });
        dataManager.loadJsonData(fixturePath + 'dummyData.json', function(d){
            d = d;
        });
    });

});
                    </code></pre>
                </section>

                <section>
                    <h2>Data Loader Code</h2>
                    <pre><code data-trim contenteditable>
demo.graphs.dataManager = function module(){
    var exports = {},
        dispatch = d3.dispatch('dataReady', 'dataLoading', 'dataError'),
        data;

    d3.rebind(exports, dispatch, 'on');

    exports.loadJsonData = function(_file, _cleaningFn){
        var loadJson = d3.json(_file);

        loadJson.on('progress', function(){
            dispatch.dataLoading(d3.event.loaded);
        });

        loadJson.get(function (_err, _response){
            if(!_err){
                _response.data.forEach(function(d){
                    _cleaningFn(d);
                });
                data = _response.data;
                dispatch.dataReady(_response.data);
            }else{
                dispatch.dataError(_err.statusText);
            }
        });
    };

    exports.getCleanedData = function(){
        return data;
    };

    return exports;
};
                    </code></pre>
                </section>


				<!-- List Template -->
				<section>
					<h2></h2>
					<ul>
						<li></li>
					</ul>
				</section>

				<!-- Link Template -->
				<section>
					<h2></h2>
					<p></p>
				</section>

				<!-- Code Template -->
				<section>
					<h2></h2>
					<pre><code data-trim contenteditable>
function linkify( selector ) {
  if( supports3DTransforms ) {

    var nodes = document.querySelectorAll( selector );

    for( var i = 0, len = nodes.length; i &lt; len; i++ ) {
      var node = nodes[i];

      if( !node.className ) {
        node.className += ' roll';
      }
    }
  }
}
					</code></pre>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>
		<script src="js/d3.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
